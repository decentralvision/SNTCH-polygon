"use strict";

const {
  parse
} = require('querystring');

const readBody = require('./readBody');

const toMultiValueHeaders = require('./toMultiValueHeaders');
/**
 * Converts an IncomingMessage to an AWS lambda event.
 * @param request
 */


module.exports = async function toLambdaEvent(request) {
  const [path, search] = request.url.split(/\?/);
  const query = parse(search);
  const body = await readBody(request);
  return {
    path,
    multiValueQueryStringParameters: query,
    httpMethod: request.method,
    isBase64Encoded: true,
    body: body.toString('base64'),
    multiValueHeaders: toMultiValueHeaders(request.headers)
  };
};